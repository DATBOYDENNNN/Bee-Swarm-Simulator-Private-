local Library = loadstring(game:HttpGet('https://raw.githubusercontent.com/Rain-Design/Unnamed/main/Library.lua'))()

-- ========== CONFIGURATION / STATE ==========
-- [EDUCATIONAL] These variables store the "state" of your script. 
-- Adding a new feature usually starts by adding a variable here.
local Config = {
    isFarming = false,
    currentField = "Sunflower Field",
    walkSpeed = 50,
    collectRadius = 80,
    isConverting = false,
    myPlatform = nil,
    farmBubbles = false,
    farmBalloons = false,
    menuKeybind = Enum.KeyCode.F3 -- Default keybind
}

local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local VirtualUser = game:GetService("VirtualUser")
local player = Players.LocalPlayer

local FlowerZones = workspace:WaitForChild("FlowerZones")
local Fields = {"Sunflower Field", "Mushroom Field", "Clover Field", "Spider Field", "Blue Flower Field", "Strawberry Field", "Bamboo Field", "Pine Tree Forest", "Cactus Field", "Pumpkin Patch", "Rose Field", "Mountain Top Field", "Ant Field"}

-- ========== ANTI-AFK ==========
player.Idled:Connect(function()
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new())
end)

-- ========== PERMANENT SPEED LOCK ==========
RunService.Stepped:Connect(function()
    if player.Character and player.Character:FindFirstChild("Humanoid") then
        player.Character.Humanoid.WalkSpeed = Config.walkSpeed
    end
end)

-- ========== VISUALIZER (0.4 BLUE BOX) ==========
local FieldBox = Instance.new("Part")
FieldBox.Name = "MacroVisualBox"
FieldBox.Material = Enum.Material.ForceField
FieldBox.Color = Color3.fromRGB(0, 150, 255)
FieldBox.Transparency = 1 
FieldBox.CanCollide = false
FieldBox.Anchored = true
FieldBox.Parent = workspace

local function updateFieldVisual()
    local zone = FlowerZones:FindFirstChild(Config.currentField)
    if Config.isFarming and zone and not Config.isConverting then
        FieldBox.Transparency = 0.4
        FieldBox.Size = zone.Size + Vector3.new(0, 2, 0)
        FieldBox.CFrame = zone.CFrame
    else
        FieldBox.Transparency = 1
    end
end

-- ========== CORE FUNCTIONS ==========
local function scanForHive()
    local platforms = workspace:FindFirstChild("HivePlatforms")
    if platforms then
        for _, plat in pairs(platforms:GetChildren()) do
            local playerRef = plat:FindFirstChild("PlayerRef")
            if playerRef and playerRef.Value == player then 
                Config.myPlatform = plat
                return true 
            end
        end
    end
    return false
end

local function deployToField()
    local zone = FlowerZones:FindFirstChild(Config.currentField)
    local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    if zone and hrp then
        hrp.Anchored = false 
        hrp.Velocity = Vector3.zero
        hrp.CFrame = zone.CFrame * CFrame.new(0, 3, 0)
        task.wait(0.3)
        VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.One, false, game)
        task.wait(0.05)
        VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.One, false, game)
    end
end

-- ========== UI SETUP ==========
-- [EDUCATIONAL] Library:Window creates the main frame. 
-- Library.Theme can be "Dark", "Light", or a custom Color3.
Library.Theme = "Dark" 
local Window = Library:Window({ Text = "BSS Internal V70 - PRO" })

local MainTab = Window:Tab({ Text = "Macro Setup" })
local TPTab = Window:Tab({ Text = "Teleports" })
local ExploitTab = Window:Tab({ Text = "Exploits" })
local SettingsTab = Window:Tab({ Text = "Settings" }) -- New Settings Tab

-- SECTIONS
local FarmSection = MainTab:Section({ Text = "Automation" })
local MacroSettings = MainTab:Section({ Text = "Macro Config" })
local TPSection = TPTab:Section({ Text = "Field Teleports" })
local StickerSection = ExploitTab:Section({ Text = "Stickers" })
local MenuSection = SettingsTab:Section({ Text = "Menu Customization" })
local InfoSection = SettingsTab:Section({ Text = "Player Info" })

-- INFO SECTION (Honey Tracker)
-- [EDUCATIONAL] Labels are great for showing real-time data.
local HoneyLabel = InfoSection:Label({ Text = "Honey: 0" })
task.spawn(function()
    while task.wait(0.5) do
        local stats = player:FindFirstChild("CoreStats")
        if stats and stats:FindFirstChild("Honey") then
            -- Formats number with commas (e.g., 1,000,000)
            local formattedHoney = tostring(stats.Honey.Value):reverse():gsub("%d%d%d", "%1,"):reverse():gsub("^,", "")
            HoneyLabel:SetText("Current Honey: " .. formattedHoney)
        end
    end
end)

-- MENU CUSTOMIZATION
MenuSection:Colorpicker({
    Text = "Menu Accent Color",
    Default = Color3.fromRGB(0, 150, 255),
    Callback = function(color)
        Library.Theme = color -- Updates the UI theme instantly
    end
})

MenuSection:Bind({
    Text = "Open/Close Menu",
    Default = Enum.KeyCode.F3,
    Callback = function(key)
        Config.menuKeybind = key
    end
})

-- STICKERS
StickerSection:Button({
    Text = "Reveal & TP All Stickers",
    Callback = function()
        local folder = workspace:FindFirstChild("HiddenStickers")
        if folder then
            for _, sticker in pairs(folder:GetChildren()) do
                sticker.Transparency = 0.3
                sticker.CFrame = player.Character.HumanoidRootPart.CFrame
                local cd = sticker:FindFirstChildOfClass("ClickDetector")
                if cd then fireclickdetector(cd) end
            end
        end
    end
})

-- MACRO CONTROLS
local farmToggle = FarmSection:Toggle({
    Text = "ENABLE MACRO (Q)",
    Callback = function(bool)
        Config.isFarming = bool
        if Config.isFarming then scanForHive() deployToField() end
    end
})

FarmSection:Dropdown({ Text = "Select Field", List = Fields, Callback = function(v) Config.currentField = v end })
FarmSection:Toggle({ Text = "Farm Bubbles", Callback = function(b) Config.farmBubbles = b end })
FarmSection:Toggle({ Text = "Farm Balloons", Callback = function(b) Config.farmBalloons = b end })

MacroSettings:Slider({
    Text = "Permanent WalkSpeed",
    Default = 50, Minimum = 16, Maximum = 200,
    Callback = function(v) Config.walkSpeed = v end
})

MacroSettings:Slider({ Text = "Collect Radius", Default = 80, Minimum = 20, Maximum = 200, Callback = function(v) Config.collectRadius = v end })

-- TELEPORTS
for _, name in ipairs(Fields) do
    TPSection:Button({Text = name, Callback = function() 
        local z = FlowerZones:FindFirstChild(name)
        if z then player.Character.HumanoidRootPart.CFrame = z.CFrame * CFrame.new(0,5,0) end 
    end})
end

-- ========== LOOPS ==========

-- AUTO-CLICK
task.spawn(function()
    while true do
        if Config.isFarming and not Config.isConverting then
            VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 0)
            task.wait(0.01)
            VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 0)
            task.wait(0.01)
        else task.wait(0.5) end
    end
end)

-- MOVEMENT ENGINE
local ignored = {}
RunService.Heartbeat:Connect(function()
    updateFieldVisual()
    if not Config.isFarming or Config.isConverting then return end
    local char = player.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    local hum = char and char:FindFirstChild("Humanoid")
    if not hrp or not hum then return end

    local target = nil
    local bestDist = Config.collectRadius
    local zone = FlowerZones:FindFirstChild(Config.currentField)
    local folders = {workspace:FindFirstChild("Collectibles"), workspace:FindFirstChild("Tokens")}
    if Config.farmBubbles then table.insert(folders, workspace:FindFirstChild("Particles")) end
    
    for _, folder in pairs(folders) do
        if folder then
            for _, v in pairs(folder:GetChildren()) do
                if not ignored[v] then
                    local p = v:IsA("BasePart") and v.Position or v:GetPivot().Position
                    local dist = (hrp.Position - p).Magnitude
                    local inField = true
                    if zone then
                        local rel = zone.CFrame:PointToObjectSpace(p)
                        if math.abs(rel.X) > zone.Size.X/2 or math.abs(rel.Z) > zone.Size.Z/2 then inField = false end
                    end
                    if inField and dist < bestDist then bestDist = dist target = v end
                end
            end
        end
    end

    if not target and Config.farmBalloons and workspace:FindFirstChild("Balloons") then
        for _, b in pairs(workspace.Balloons.FieldBalloons:GetChildren()) do
            if b:FindFirstChild("BalloonBody") and b:FindFirstChild("PlayerName") and b.PlayerName.Value == player.Name then
                target = b.BalloonBody break
            end
        end
    end

    if target then
        local tPos = target:IsA("BasePart") and target.Position or target:GetPivot().Position
        hum:MoveTo(Vector3.new(tPos.X, hrp.Position.Y, tPos.Z))
        if (hrp.Position - tPos).Magnitude < 5 then
            ignored[target] = true
            task.delay(1, function() ignored[target] = nil end)
        end
    end
end)

-- AUTO-CONVERT
task.spawn(function()
    while task.wait(1) do
        local stats = player:FindFirstChild("CoreStats")
        local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
        if Config.isFarming and stats and stats.Pollen.Value >= stats.Capacity.Value and not Config.isConverting then
            Config.isConverting = true
            if not Config.myPlatform then scanForHive() end
            
            hrp.Velocity = Vector3.zero
            local platPos = Config.myPlatform:GetPivot()
            hrp.CFrame = CFrame.new(platPos.X, platPos.Y + 3, platPos.Z) 
            task.wait(0.3)
            hrp.Anchored = true 
            
            VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.E, false, game)
            
            local stuckTimer = 0
            while Config.isFarming and stats.Pollen.Value > 0 do
                local oldPollen = stats.Pollen.Value
                task.wait(1)
                if stats.Pollen.Value >= oldPollen then
                    stuckTimer = stuckTimer + 1
                else
                    stuckTimer = 0 
                end

                if stuckTimer >= 4 then
                    VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.E, false, game)
                    stuckTimer = 0 
                end
            end
            
            task.wait(2.5) 
            hrp.Anchored = false
            Config.isConverting = false
            deployToField()
        end
    end
end)

-- ========== KEYBOARD HANDLING ==========
UserInputService.InputBegan:Connect(function(i, gpe)
    if gpe then return end
    
    -- Farm Toggle Key
    if i.KeyCode == Enum.KeyCode.Q then 
        Config.isFarming = not Config.isFarming 
        farmToggle:Set(Config.isFarming)
    
    -- Menu Keybind (Uses the variable from Settings)
    elseif i.KeyCode == Config.menuKeybind then
        local ui = game:GetService("CoreGui"):FindFirstChild("Unnamed") or player.PlayerGui:FindFirstChild("Unnamed")
        if ui then ui.Enabled = not ui.Enabled end
    end
end)
